<link rel="stylesheet" href="/user/styles/home.css">
<link rel="stylesheet" href="/user/styles/account.css">

<nav aria-label="Breadcrumb">
  <ol class="breadcrumbs">
    <li class="breadcrumb-item">
      <a href="/">Home</a>
    </li>
    <li class="breadcrumb-item">
      <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/bfd80c0d91b083fd6615c46809d59a6436c7d8053b049a460c5e712a453a7f67?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="breadcrumb-separator" />
      <a>User</a>
    </li>
    <li class="breadcrumb-item breadcrumb-current">
      <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/bfd80c0d91b083fd6615c46809d59a6436c7d8053b049a460c5e712a453a7f67?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="breadcrumb-separator" />
      <span aria-current="page">Account</span>
    </li>
  </ol>
</nav>

<section class="profile-content">
    
  <ul class="nav nav-underline" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane"
        type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="true">Profile</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="wishlist-tab" data-bs-toggle="tab" data-bs-target="#wishlist-tab-pane"
        type="button" role="tab" aria-controls="wishlist-tab-pane" aria-selected="false">Wishlist</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="order-tab" data-bs-toggle="tab" data-bs-target="#order-tab-pane"
        type="button" role="tab" aria-controls="order-tab-pane" aria-selected="false">Orders</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="address-tab" data-bs-toggle="tab" data-bs-target="#address-tab-pane"
        type="button" role="tab" aria-controls="address-tab-pane" aria-selected="false">Address List</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="wallet-tab" data-bs-toggle="tab" data-bs-target="#wallet-tab-pane"
        type="button" role="tab" aria-controls="wallet-tab-pane" aria-selected="false">Wallet</button>
    </li>
  </ul>

  <div class="tab-content" id="myTabContent">
    <!-- Profile Content -->
    <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
      <main class="profile-main">
        <div class="profile-content-wrapper">
          {{#if user}}
            <div class="d-inline-flex">
              <section class="profile-details justify-content-start me-5">
                <div class="profile-info">
                  <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/a9ff52b486f5f256ce18201df038f1ad749d76da00593d4dad07284d94a4f057?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Profile picture of Andrew Johnson" class="profile-image" />
                  <div class="profile-name-wrapper">
                    <h2 class="profile-name capitalize">{{#if user.fullname}}{{user.fullname}}{{else}}Name not added{{/if}}</h2>
                    <p class="profile-registration-date capitalize">Username: {{user.username}}</p>
                    <p class="profile-registration-date">Registered : {{formatDate user.createdAt 'Do MMM YYYY'}}</p>
                  </div>
                </div>
                
                <h3 class="contact-details-title">Contact Details</h3>
                
                <div class="contact-item">
                  <label for="email" class="contact-label">Email</label>
                  <div class="contact-value-wrapper">
                    <span id="email" class="contact-value">{{user.email}}</span>
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/b0055d5960161116c2de4b685eea64306b3a1677776a99fbefb3c57a14d0e093?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Edit email" class="edit-icon" />
                  </div>
                </div>
                
                <div class="contact-item">
                  <label for="phone" class="contact-label">Phone</label>
                  <div class="contact-value-wrapper">
                    <span id="phone" class="contact-value">{{#if user.phone}}{{user.phone}}{{else}}Phone number not added{{/if}}</span>
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/05712ab9061ae068c87cc14e545f79cdd88cf9ec89174e97c9d54cd1a12bb95a?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Edit phone" class="edit-icon" />
                  </div>
                </div>
                
                <div class="address-item">
                  <h4 class="default-address-label">Default Address</h4>
                  {{#if address}}
                    <div class="address-wrapper">
                      <address class="capitalize">
                        {{address.address}}, {{address.street}}
                        {{#if address.landmark}}{{address.landmark}},{{/if}}
                        {{address.city}}, {{address.pincode}}
                        {{address.state}}, {{address.country}}
                      </address>
                      <img class="edit-icon mt-0 mb-auto" src="https://cdn.builder.io/api/v1/image/assets/TEMP/1ad6a131dc6cfa00bec5f959525314842c1054740a056fb50f8b8a036741c07e?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Edit address" />
                    </div>
                  {{else}}
                    <a class="address-card add-address cursor-pointer" style="flex: 1 0 auto; height:fit-content; min-height: 100px;"
                      data-bs-toggle="modal" data-bs-target="#addAddress">
                      <div class="add-icon">
                        
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/438dbd9477d0a60b44e7a0c62d18130328e87a79af1c19d6685d2bda4e1e0839?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="add-icon-plus" loading="lazy">
                        
                      </div>
                      <p class="add-text">Add New Address</p>
                    </a>
                  {{/if}}
                </div>
              </section>
              
              <section class="payment-methods">
                <h3 class="payment-methods-title">Payment Methods</h3>
                
                <div class="payment-method-item">
                  <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/db4feefa90866f1f6bce888fd21c64b1d501efa77196bfff10c9cbfffd506f92?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Visa card logo" class="payment-method-logo" />
                  <div class="payment-method-details">
                    <p class="payment-method-number">Visa ...........8134</p>
                    <p class="payment-method-expiry">Expires on 12/28</p>
                  </div>
                </div>
                
                <div class="payment-method-item mb-2">
                  <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/10ccf153290ecaf42b750b046afefed87cc40f4e6719aab20ed3f7a2b9d5b60f?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Visa card logo" class="payment-method-logo" />
                  <div class="payment-method-details">
                    <p class="payment-method-number">Visa ...........8134</p>
                    <p class="payment-method-expiry">Expires on 12/28</p>
                  </div>
                </div>
                
                <a class="address-card add-address cursor-pointer" style="flex: 1 0 auto; height:fit-content; min-height: 100px;"
                  >
                  <div class="add-icon">
                    
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/438dbd9477d0a60b44e7a0c62d18130328e87a79af1c19d6685d2bda4e1e0839?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="add-icon-plus" loading="lazy">
                    
                  </div>
                  <p class="add-text">Add payment methods</p>
                </a>
              </section>
            </div>
        
            <button class="more-button">
              <i class="las la-ellipsis-v fs-4"></i>
              <ul class="popup-menu">
                <li class="border-bottom">
                  <a data-bs-toggle="modal" data-bs-target="#changePassword">
                    <i class="las la-key fs-4"></i>
                    <span>Change Password</span>
                  </a>
                </li>
                <li>
                  {{#if user.fullname}}
                    <a data-bs-toggle="modal" data-bs-target="#addProfileInfo" id="btn-edit-profile">
                      <i class="las la-user-edit fs-4"></i>
                      <span>Edit Profile</span>
                    </a>
                  {{else}}
                    <a data-bs-toggle="modal" data-bs-target="#addProfileInfo">
                      <i class="las la-user-plus fs-4"></i>
                      <span>Add Profile Detail</span>
                    </a>
                  {{/if}}
                </li>
              </ul>
            </button>
          {{else}}
            <div class="d-flex align-items-center justify-content-center w-100">
              <a class="add-payment-method w-auto border cursor-pointer" data-bs-toggle="modal" data-bs-target="#addProfileInfo">
                <div class="add-payment-method-wrapper">
                  <div class="add-icon-wrapper">
                    <div class="line"></div>
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/23f93985a910118e5d07ce17ba3ca5d961fe60fe692ce499e7f2ad2f5ffd468e?apiKey=4312beba142048a48d6010ff440bfdd8&" alt="Add payment method" class="add-icon" />
                    <div class="line"></div>
                  </div>
                  <p class="add-payment-method-text">Add profile detail</p>
                </div>
              </a>
            </div>
          {{/if}}
        </div>
      </main>
    </div>

    {{!-- Wishlist --}}
    <div class="tab-pane fade" id="wishlist-tab-pane" role="tabpanel" aria-labelledby="wishlist-tab" tabindex="0">
      <section class="addresses-section d-flex flex-column">
        <div class="products-list">

          <!-- Cart Item -->
          <div class="product-row">
            {{#each wishlist}}
            <div class="product-item-card  wishlist-item">
              <a class="product-header cursor-pointer z-10" style="top: 1.5%;" onclick="removeWishlistItem('{{this._id}}')">
                <i class="las la-times fs-4 border rounded product-badge"></i>
              </a>
              <a href="/view-product/{{this.product.product_slug}}" class="card-detail-wrapper">
                <div class="bg-warning product-warning-badge">
                  <span class="badge">New</span>
                </div>
                <div class="card-img-wrapper">
                  <img src="{{this.product.images.[0]}}" alt="{{this.product.product_name}}">
                </div>
                <div class="d-flex flex-column w-100 rate-sum-wrapper">
                  <div class="d-inline-flex align-items-center justify-content-between">
                    <small class="capitalize small-muted">{{this.product.category.category_name}}</small>
                    <small class="capitalize small-muted {{#if this.product.stock}}text-success{{else}}text-danger{{/if}}">
                      {{#if this.product.stock}}{{this.product.stock}} in stock
                      {{else}}Out of stock
                      {{/if}}
                    </small>
                  </div>
                  <h6 class="mb-1">{{this.product.product_name}}</h6>
                  <div class="d-inline-flex card-rating">
                    <div class="product-card-rate-sum d-inline-block">
                      <div class="product-rating" style="width:{{this.product.rating.outOfFivePercent}}%">
                      </div>
                    </div>
                    <span class="mb-0 ms-1 card-rating-value">{{this.product.rating.averageRating}}</span>
                    <span class="devider"></span>
                    <i class="las la-sms"></i>
                    <span class="mb-0 ms-1 card-rating-value">{{this.product.rating.totalReviews}}</span>
                  </div>
                </div>
              </a>
              <div class="card-price-wrapper">
                <div class="d-inlne-flex flex-column">
                  <h4 class="m-0 price" style="line-height:1 !important">
                    {{#if this.product.discount}}{{this.product.pricing.selling_price}}
                    {{else}}{{this.product.pricing.original_price}}
                    {{/if}}
                  </h4>
                  {{#if this.product.discount}}
                  <div class="d-inline-flex card-offers">
                    <span class="original-price price"  style="line-height:1 !important">{{this.product.pricing.original_price}}</span>
                    <span class="ms-1 off-discount">-<span class="{{#if (eq this.product.discount_type 'fixed')}}price{{else}}percentage{{/if}}">{{this.discount}}</span></span>
                  </div>
                  {{/if}}
                </div>
                <div class="card-icons-wrapper">
                  <img src="/admin/images/icons/cart_outline.svg" onclick="addToBag('{{@index}}','{{this.product._id}}','{{this._id}}')" alt="">
                </div>
              </div>
            </div>
            {{else}}
              <div class="d-flex border w-100 justify-content-center rounded py-5">
                <h5 class="m-0">Wishlist is empty now</h5>
              </div>
            {{/each}}
          </div>

        </div>
      </section>
    </div>
    
    <!-- Order Content -->
    <div class="tab-pane fade show active" id="order-tab-pane" role="tabpanel" aria-labelledby="order-tab" tabindex="0">

        <section class="orders-container">

          <header class="orders-header mb-4">
            <!-- search -->
            <div class="search flex-1">
              <div class="search-icon">
                <i class="las la-search filp-x fs-4"></i>
              </div>
              <input type="text" class="form-control" placeholder="Search">
            </div>

            <!-- Date fileter -->
            <div class="date-filter me-4">
              <span class="filter-label">From</span>
              <a class="filter-input">
                <input type="text" class="filter-prompt" value="1-1-2024" readonly>
                <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/018462b45b658d6fc9d7e7e6ae6086d2177b2c2a1c8d891d191d701a49e620c9?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
              </a>
              <span class="filter-label">to</span>
              <a class="filter-input">
                <input type="text" class="filter-prompt" value="1-1-2024" readonly>
                <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/018462b45b658d6fc9d7e7e6ae6086d2177b2c2a1c8d891d191d701a49e620c9?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
              </a>
            </div>
            <div class="filters-container">
              <button class="filter-button order-sort" aria-haspopup="true" aria-expanded="false">
                <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/86be1cc7087c459037f23a1a8525973b5bd637b3f018b648bef0e0202506cd20?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                <span class="filter-label">Sort</span>
                <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/03e7ee19e122813c19f899876a57aab2dfc33119df9ffa008ae004e95b29bc8d?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-arrow" />
                <ul class="popup-menu">
                  <li class="border-bottom">
                    <a href="#"><span>By order date</span></a>
                  </li>
                  <li class="border-bottom">
                    <a href="#"><span>By amount: Low to High</span></a>
                  </li>
                  <li>
                    <a href="#"><span>By amount: High to Low</span></a>
                  </li>
                </ul>
              </button>
              <button class="filter-button order-sort" aria-haspopup="true" aria-expanded="false">
                <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/938286f7a2fbefae82347a9745ca082951967b907a09196ba5ba4900c8537499?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                <span class="filter-label">Filter</span>
                <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/03e7ee19e122813c19f899876a57aab2dfc33119df9ffa008ae004e95b29bc8d?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-arrow" />
                <ul class="popup-menu">
                  <li class="border-bottom">
                    <a href="#">
                      <input type="checkbox" id="check-filter-none" class="me-2" checked>
                      <label for="check-filter-none">None</label>
                    </a>
                  </li>
                  <li class="border-bottom">
                    <a href="#">
                      <input type="checkbox" id="check-filter-pending" class="me-2">
                      <label for="check-filter-pending">Pending</label>
                    </a>
                  </li>
                  <li class="border-bottom">
                    <a href="#">
                      <input type="checkbox" id="check-filter-shipped" class="me-2">
                      <label for="check-filter-shipped">Shipped</label>
                    </a>
                  </li>
                  <li class="border-bottom">
                    <a href="#">
                      <input type="checkbox" id="check-filter-deliverd" class="me-2">
                      <label for="check-filter-deliverd">Deliverd</label>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <input type="checkbox" id="check-filter-cancelled" class="me-2">
                      <label for="check-filter-cancelled">Cancelled</label>
                    </a>
                  </li>
                </ul>
              </button>
            </div>
          </header>
        
          {{#each orders}}
            <section class="d-flex flex-column border p-3 mb-3">
              <div class="order-header mb-3">
                <div>
                  <span class="detail-label">Order No:</span>
                  <span class="order-number pe-0">{{this.order_no}}</span>
                  <span>({{length this.orderItems}})</span>
                </div>
                <span class="status small
                {{#if (eq this.order_status 'pending')}} grey
                {{else if (eq this.order_status 'cancelled')}} red
                {{else if (eq this.order_status 'shipped')}} blue
                {{else if (eq this.order_status 'delivered')}} green
                {{else}} orange
                {{/if}}">{{this.order_status}}</span>
                {{#if (eq this.order_status 'payment pending')}}
                <button class="order-button error" onclick="retryPayment('{{this._id}}')">Retry Payment</button>
                {{/if}}
                <div class="order-actions m-0">
                  <div class="action-button show-pop">
                    <span>Ship to</span>
                    <div class="arrow-box">
                      <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/c4a751a1cef7571f1df2efc9075a2d196b3a08f7c8dd259f012aa9ebc7686357?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                      
                      <div class="address-pop">
                        <h3 class="address-name">Davood Hakkim</h3>
                        <p class="address-details m-0">
                          {{this.shipping_address.address}}, {{this.shipping_address.street}},
                          {{#if this.shipping_address.landmark}}{{this.shipping_address.landmark}},{{/if}}
                          {{this.shipping_address.city}}, {{this.shipping_address.pincode}}
                          {{this.shipping_address.state}}, {{this.shipping_address.country}}
                        </p>
                      </div>
                    </div>                    
                  </div>
                  <span class="action-divider"></span>
                  <a href="/user/download-invoice?order={{this._id}}" 
                    class="action-button {{#if (eq this.order_status 'cancelled')}}disable-element{{/if}}">
                    <span>Invoice</span>
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/7a7cb771bf7454fc003898e0a180ba133271780a6461f20e348e4a803c0c3772?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                  </a>
                  <span class="action-divider"></span>
                  <a href="/user/view-order?id={{this._id}}" class="action-button">
                    <span>Order Detail</span>
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/c4a751a1cef7571f1df2efc9075a2d196b3a08f7c8dd259f012aa9ebc7686357?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                  </a>
                </div>
              </div>
              {{#each this.orderItems}}
                <article class="order-item mb-1">
                  <img src="{{this.thumb}}" alt="Apple iPhone 14 Pro Max" class="product-image" />
                  <div class="order-content">
                    <div class="order-info">
                      <h2 class="product-name fw-bold m-0">{{this.product_name}}</h2>
                      <div class="order-details m-0">
                        <div class="order-date">
                          <span class="detail-label">Placed:</span>
                          <span class="detail-value">{{formatDate ../createdAt 'DD MMM YYYY'}}</span>
                        </div>
                        <div class="order-quantity">
                          <span class="detail-label">Qty:</span>
                          <span class="detail-value">{{this.quantity}}</span>
                        </div>
                      </div>
                      
                    </div>
                    <div class="order-total">
                      <span class="total-label">Total</span>
                      <span class="total-value price">{{this.item_total}}</span>
                    </div>
                  </div>
                  <div class="order-buttons">
                    {{#if (eq ../order_status 'delivered')}} 
                      <button class="order-button" data-val="{{this.product_id}}" data-bs-toggle="modal" data-bs-target="#addReview">
                        Add Review
                      </button>
                    {{else}}
                      {{#if (or (eq this.item_status 'cancelled') (eq ../order_status 'cancelled'))}}
                        <button class="order-button bg-light" disabled>
                          Cancelled
                        </button>
                      {{else}}
                        <button class="order-button" onclick="cancelItem('{{../_id}}','{{this.item_id}}')">
                          Cancel Item
                        </button>
                      {{/if}}
                    {{/if}}
                  </div>
                </article>
              {{/each}}
            </section>
          {{else}}
            <div class="d-flex border w-100 justify-content-center rounded py-5">
              <h5 class="m-0">No orders made till yet</h5>
            </div>
          {{/each}}

        </section>
    </div>

    <!-- Address Content -->
    <div class="tab-pane fade" id="address-tab-pane" role="tabpanel" aria-labelledby="address-tab" tabindex="0">
      
      <section class="addresses-section d-flex flex-column">
        <!-- search -->
        <div class="col-5 mb-4 align-self-end">
          <div class="search">
            <div class="search-icon">
              <i class="las la-search filp-x fs-4"></i>
            </div>
            <input type="text" class="form-control" style="max-width: 100%;" placeholder="Search">
          </div>
        </div>

        <div class="address-grid">
          <a class="address-card add-address cursor-pointer" data-bs-toggle="modal" data-bs-target="#addAddress">
            <div class="add-icon">
              
              <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/438dbd9477d0a60b44e7a0c62d18130328e87a79af1c19d6685d2bda4e1e0839?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="add-icon-plus" loading="lazy">
              
            </div>
            <p class="add-text">Add New Address</p>
          </a>
          
          {{#each user.address_list}}
            <article class="address-card">
              {{#if this.isDefault}}
                <header class="default-header">
                  <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/123dad90a2b71e75216a270a842cba4c899490ac7c81d7bc8a35cceda1d95f04?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="Default address checkmark" class="default-icon" loading="lazy">
                  <span class="default-text">Default Address</span>
                </header>
              {{/if}}
              <div class="address-body">
                <div class="capitalize">
                  <h3 class="address-name">{{this.fullname}}</h3>
                  <p class="address-details">
                    {{this.address}}, {{this.street}},
                    {{#if this.landmark}}{{this.landmark}},{{/if}}
                    {{this.city}}, {{this.pincode}}
                    {{this.state}}, {{this.country}}
                  </p>
                </div>
                <div class="address-actions">
                  <button class="action-button" onclick="editAddress('{{json this}}')">Edit</button>
                  <span class="action-separator"></span>
                  <button class="action-button" onclick="deleteAddress('{{json this._id}}')">Remove</button>
                  {{#unless this.isDefault}}
                    <span class="action-separator"></span>
                    <button class="action-button"  onclick="makeDefault('{{json this._id}}')">Make Default</button>
                  {{/unless}}
                </div>
              </div>
            </article>
          {{/each}}
          
        </div>
      </section>

    </div>

    <!-- Wallet Content -->
    <div class="tab-pane fade" id="wallet-tab-pane" role="tabpanel" aria-labelledby="wallet-tab" tabindex="0">
      
      <div class="row">
          <div class="col-12">
              <div class="wallet-left-side">

                  <!-- Balcnce & Add Cash -->
                  <div class="d-flex justify-content-between align-items-center mb-4">
                      <div>
                        <div class="my-balance">Balance</div>
                        <div class="balance-amount price">{{user.wallet}}</div>
                          
                      </div>
                      <button class="btn add-cash-btn" data-bs-toggle="modal" data-bs-target="#addCash">
                          <img src="/admin/images/icons/wallet_add.svg" alt="Add Cash Icon" class="me-2 mb-1" width="18" height="18">
                          Add Cash
                      </button>
                  </div>

                  <!-- Filters -->
                  <header class="orders-header py-3 border-bottom">
                    <!-- search -->
                    <div class="search flex-1">
                      <div class="search-icon">
                        <i class="las la-search filp-x fs-4"></i>
                      </div>
                      <input type="text" class="form-control" placeholder="Search">
                    </div>
      
                    <!-- Date fileter -->
                    <div class="date-filter me-4">
                      <span class="filter-label">From</span>
                      <a class="filter-input">
                        <input type="text" class="filter-prompt" value="1-1-2024" readonly>
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/018462b45b658d6fc9d7e7e6ae6086d2177b2c2a1c8d891d191d701a49e620c9?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                      </a>
                      <span class="filter-label">to</span>
                      <a class="filter-input">
                        <input type="text" class="filter-prompt" value="1-1-2024" readonly>
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/018462b45b658d6fc9d7e7e6ae6086d2177b2c2a1c8d891d191d701a49e620c9?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                      </a>
                    </div>
                    <div class="filters-container">
                      <div class="filter-button order-sort">
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/86be1cc7087c459037f23a1a8525973b5bd637b3f018b648bef0e0202506cd20?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                        <span class="filter-label">Sort</span>
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/03e7ee19e122813c19f899876a57aab2dfc33119df9ffa008ae004e95b29bc8d?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-arrow" />
                        <div class="pop-box">
                          <ul class="popup-menu">
                            <li class="border-bottom">
                              <a href="#"><span>By date</span></a>
                            </li>
                            <li class="border-bottom">
                              <a href="#"><span>By amount: Low to High</span></a>
                            </li>
                            <li>
                              <a href="#"><span>By amount: High to Low</span></a>
                            </li>
                          </ul>
                        </div>
                      </div>
                      <button class="filter-button order-sort" aria-haspopup="true" aria-expanded="false">
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/938286f7a2fbefae82347a9745ca082951967b907a09196ba5ba4900c8537499?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-icon" />
                        <span class="filter-label">Filter</span>
                        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/03e7ee19e122813c19f899876a57aab2dfc33119df9ffa008ae004e95b29bc8d?placeholderIfAbsent=true&apiKey=4312beba142048a48d6010ff440bfdd8" alt="" class="filter-arrow" />
                        <ul class="popup-menu">
                          <li class="border-bottom">
                            <a href="#">
                              <input type="checkbox" id="check-filter-none" class="me-2" checked>
                              <label for="check-filter-none">None</label>
                            </a>
                          </li>
                          <li class="border-bottom">
                            <a href="#">
                              <input type="checkbox" id="check-filter-pending" class="me-2">
                              <label for="check-filter-pending">Deposit</label>
                            </a>
                          </li>
                          <li class="border-bottom">
                            <a href="#">
                              <input type="checkbox" id="check-filter-shipped" class="me-2">
                              <label for="check-filter-shipped">Withdrawal</label>
                            </a>
                          </li>
                        </ul>
                      </button>
                    </div>
                  </header>

                  <!-- Table header -->
                  <div class="wallet-row wallet-header py-2">
                    <div class="row">
                      <div class="col-2">Transaction Id</div>
                      <div class="col-2">Date</div>
                      <div class="col-4">Description</div>
                      <div class="col-2">
                          Transaction
                      </div>
                      <div class="col-2 text-end">Total</div>
                    </div>
                  </div>

                  <!-- Table row -->
                  {{#each transactions}}
                    <div class="wallet-row wallet-item py-2">
                      <div class="row">
                        <div class="col-2">{{this.transaction_id}}</div>
                        <div class="col-2">{{formatDate this.transaction_date 'D-M-YYYY'}}</div>
                        <div class="col-4 capitalize">{{this.description}}</div>
                        <div class="col-2">
                          {{#if (eq this.transaction_type 'deposit')}}
                          <img src="/admin/images/icons/arrow_down_small.svg" alt="">
                          {{else}}
                          <img src="/admin/images/icons/arrow_up_small.svg" alt="">
                          {{/if}}
                          <span class="price">{{this.transaction_amount}}</span>
                        </div>
                        <div class="col-2 text-end">
                          <span class="price">{{this.current_balance}}</span>
                        </div>
                      </div>
                    </div>
                  {{else}}
                  <div class="wallet-row wallet-item text-center text-warning fw-bold py-4">No transaction exists</div>
                  {{/each}}
                  
                  <nav class="pagination align-self-end py-4 m-0" aria-label="Pagination">
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/2de423749e642867f9234165a24938928b2cdf9588d343cd6065b87c0140930f?placeholderIfAbsent=true&amp;apiKey=4312beba142048a48d6010ff440bfdd8" alt="Previous page" class="pagination-arrow">
                      <div class="page-numbers">
                        <a href="#" class="page-number current-page" aria-current="page">1</a>
                        <a href="#" class="page-number">2</a>
                        <a href="#" class="page-number">3</a>
                        <span class="page-number">...</span>
                        <a href="#" class="page-number">12</a>
                      </div>
                    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/32e251b14d565c4eb407dc8336096dd9c021e5846afae8e292102cae656ec431?placeholderIfAbsent=true&amp;apiKey=4312beba142048a48d6010ff440bfdd8" alt="Next page" class="pagination-arrow">
                  </nav>
              </div>
          </div>
        </div>

    </div>

  </div>
  
</section>

<div class="modal fade" id="addProfileInfo" tabindex="-1" aria-labelledby="addProfileInfoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
          <div class="modal-body container-fluid">
            <div class="close-wrapper">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <h5 class="modal-title">Add profile info</h5>
            <form class="row flex-row flex-wrap w-100" id="add-profile-info" autocomplete="off">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="review-title">Fullname</label>
                  <input type="text" class="form-control" name="fullname" value="{{user.fullname}}" placeholder="Enter your fullname">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="review-title">Username</label>
                  <input type="text" class="form-control" name="username" value="{{user.username}}" placeholder="Enter your username">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="review-title">Phone</label>
                  <input type="number" class="form-control" name="phone" value="{{user.phone}}" placeholder="Enter your phone number">
                </div>
              </div>
            </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                data-bs-dismiss="modal">Close</button>
              <button type="submit" id="submit-profile-info">Submit</button>
            </div>
      </div>
  </div>
</div>

<div class="modal fade" id="changePassword" tabindex="-1" aria-labelledby="cahngePasswordLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body container-fluid">
        <div class="close-wrapper">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <h5 class="modal-title">Change Password</h5>
        <form action="/change-password/{{user._id}}" method="post" id="change-user-password" autocomplete="off">
          <div class="form-group mb-3">
            <label for="review-title">New Password</label>
            <input type="password" class="form-control" name="password"  placeholder="Enter your new password">
          </div>
          <div class="form-group mb-3">
            <label for="review-title">Confirm Password</label>
            <input type="password" class="form-control" name="confirm" placeholder="Re-enter your password">
          </div>
        </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            data-bs-dismiss="modal">Close</button>
          <button type="submit" form="change-user-password">Submit</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addCash" tabindex="-1" aria-labelledby="addCashLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body container-fluid">
        <div class="close-wrapper">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <h5 class="modal-title">Select Account</h5>
        <form action="/add-to-wallet/{{user._id}}" id="add-wallet-cash" method="post" autocomplete="off">
          <div class="form-group mb-3">
            <select name="payment_method" id="select-pay-method" class="form-select">
              <option value="">Select Payment Method</option>
              <option value="razorpay">Razorpay</option>
            </select>
          </div>
          <div class="form-group mb-3">
            <label>Amount</label>
            <input type="number" class="form-control pay-amount" name="transaction_amount" placeholder="Enter Amount">
          </div>
          <div class="form-group mb-3">
            <label>Description</label>
            <textarea name="description" class="form-control" id="" placeholder="Enter description here"></textarea>
          </div>
        </form>
        <div class="modal-footer">
          <button
            type="button"
            data-bs-dismiss="modal">Close</button>
          <button type="submit" id="add-cash">Add</button>
        </div>
      </div>
    </div>
  </div>
</div>

{{> add_review}}

<script>

  const wishlist = {{{json wishlist}}}
  
  if(wishlist.length){
    
    wishlist.forEach((item,i) => {

      const badge_wrapper = $('.product-row .product-item-card').eq(i).find('.product-warning-badge')
      const badge = $('.product-row .product-item-card').eq(i).find('.product-warning-badge .badge')
    
      if(item.product.product_status === 'disabled' || 
        item.product.category.category_status === 'disabled'){
          $(badge_wrapper).removeClass('d-none')
        }else{
          $(badge_wrapper).addClass('d-none')
        }
      
      if(item.product.product_status === 'disabled' || item.product.category.category_status === 'disabled'){
        $(badge_wrapper).addClass('bg-danger-subtle')
        $(badge).addClass('text-danger')
        $(badge).html('Unavailable')
      }
      
    })
  }
  
  // varable for setting profile edit query
  let query = '';
  /* Add profile info*/
  $('#submit-profile-info').on('click', function(){

    const data = $('#add-profile-info').serialize()

    $.ajax({
      type: 'POST',
      url: `/add-profile-info${query}`,
      data: data,
      success: function(res){
        
        Toast(2000,res.icon,res.msg).then(()=>{
          if(res.status == 201){
            location.reload()
          }
        })
      }
    })

  })

  $('#btn-edit-profile').on('click', function(){
    $('#addProfileInfo').find('.modal-title').text('Edit Profile Info')
    query='?edit=true'
  })

  function deleteAddress(id){
    id = JSON.parse(id)
    Swal.fire({
      title: 'Are you sure?',
      icon: 'warning',
      text: 'You will not be able to recover this address!',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      $.ajax({
        type: 'GET',
        url: `/delete-address/${id}`,
        success: function(res){
          
          if(res.status == 200){
            location.reload()
            Toast(1500,res.icon,res.msg)
          }
        }
      })
    })
  }


  function makeDefault(id){
    id = JSON.parse(id)
    $.ajax({
      url: `/make-default-address/${id}`,
      type: 'POST',
      success: function(res){
        if(res.success){
          window.location.reload()
        }else{
          Toast(2000,res.icon,res.msg)
        }
      },
    })
  }

  const status = '{{acc_info.status}}'
  
  if(status.length){
    if(status == 'password_error'){
      let myModal = new bootstrap.Modal($('#changePassword'))
      myModal.show()
      Toast(2000,'{{acc_info.icon}}','{{acc_info.msg}}')
    }else{
      Toast(2000,'{{acc_info.icon}}','{{acc_info.msg}}')
      if(status == 201){
        $.ajax({
          type: 'GET',
          url: `/clear-session/${status}?redirect=true`,
          success: function(res){},
        })
      }
    }
  }

  // Wallet
  $('#add-cash').on('click', function(){
    const pay_method = $('#select-pay-method :selected').val()
    const amount = $('.pay-amount').val()

    if(pay_method == ''){
      $('#select-pay-method').addClass('is-invalid')
      Toast(2000,'error','Please select payment method')
      return false
    }
    if(amount == '' || amount <= 0){
      $('.pay-amount').addClass('is-invalid')
      Toast(2000,'error','Please enter amount')
      return false
    }

    $('#add-wallet-cash').submit()
    $('#addCash').modal('hide')
  })

  function cancelItem(order_id, item_id){

    Swal.fire({
      title: 'Are you sure?',
      icon: 'warning',
      text: 'You will not be able to recover this item!',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, cancel it!'
    }).then((result) => {
      if(result.isConfirmed) {
        $.ajax({
          type: 'PATCH',
          url: `/cancel-item/${order_id}/${item_id}`,
          success: function(res){
            if(res.success){
              window.location.reload()
            }
            Toast(1500,res.icon,res.msg)
          }
        })
      }
    })

  }

  // remove item from wishlist
  {{!-- function removeItem(itemId) {

    $.ajax({
      type: 'DELETE',
      url:  `/remove-from-wishlist/${itemId}`,
      success: function(response) {
        if(response.success){
          $('.product-row .wishlist-item').eq([response.deletedIndex]).remove()
          if(response.wishlist_count === 0){
            window.location.reload()
          }else{
            $('.bubble').attr('aria-label', `${response.wishlist_count}`)
          }
        }
      },
      error: function(error) {
        console.log(error);
      }
    })
  } --}}

</script>